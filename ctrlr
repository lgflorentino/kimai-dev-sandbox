#!/usr/bin/env zsh

set -e 

[[ ! -d "./kimai2" ]] && echo "Please clone your copy of the kimai2 source to '$(pwd)/kimai2' before continuing" && exit 1

MYSQL_DB_URL="mysql://kimai2_test:kimai2_test@mysql:3306/kimai2_test"
PGSQL_DB_URL="postgresql://kimai2_test:kimai2_test@pgsql:5432/kimai2_test"

[[ $1 = "mysql" ]] && docker compose up -d && docker-compose run --rm \
    -e DATABASE_URL=${MYSQL_DB_URL} composer kimai:tests-unit

[[ $1 = "pgsql" ]] && docker compose up -d && docker-compose run --rm \
    -e DATABASE_URL=${PGSQL_DB_URL} composer kimai:tests-unit

[[ "$1" = "--help" || "$1" = "-h" || "$1" = "help" || -z "$1" ]] && \
    echo "usage: \n\t\t$0"

echo "Exiting $0..."
exit 0
